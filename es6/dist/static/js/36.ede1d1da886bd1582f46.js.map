{"version":3,"sources":["webpack:///static/js/36.ede1d1da886bd1582f46.js","webpack:///./src/project/mywater/waterquery/pages/billRead.vue","webpack:///src/project/mywater/waterquery/pages/billRead.vue","webpack:///./src/project/mywater/waterquery/pages/billRead.vue?c91c","webpack:///./src/project/mywater/waterquery/pages/billRead.vue?7240","webpack:///./src/project/mywater/waterquery/pages/billRead.vue?8193"],"names":["webpackJsonp","/huw","module","__webpack_exports__","__webpack_require__","injectStyle","ssrContext","Object","defineProperty","value","headerTwo","es","billRead","components","data","message","title","emailShow","email","readImg","goUrl","show","index","images","mounted","$","html","this","location","href","split","init","methods","_this","groupCode","localStorage","getItem","userNo","billMonth","$route","query","params","$api","fetch","apiUrl","then","res","push","sendEmail","billUpLoad","item","url","window","protocol","host","emailTest","that","console","log","reg","fail","test","beforeClose","action","done","event","stopPropagation","success","dataURLtoBlob","dataurl","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","Blob","type","onChange","takeImage","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","src","alt","_v","size","icon","nativeOn","click","$event","id","show-cancel-button","model","callback","$$v","expression","placeholder","oninput","on","blur","staticRenderFns","esExports","pages_billRead","normalizeComponent","__vue_styles__","Component","1Sl4","exports","content","i","locals","vfWn","undefined"],"mappings":"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","file":"static/js/36.ede1d1da886bd1582f46.js","sourcesContent":["webpackJsonp([36],{\n\n/***/ \"/huw\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n\n// EXTERNAL MODULE: ./src/comments/headerTwo.vue + 2 modules\nvar headerTwo = __webpack_require__(\"j8VX\");\n\n// EXTERNAL MODULE: ./node_modules/axios/index.js\nvar axios = __webpack_require__(\"mtWM\");\nvar axios_default = /*#__PURE__*/__webpack_require__.n(axios);\n\n// EXTERNAL MODULE: ./node_modules/vant/es/index.js + 137 modules\nvar es = __webpack_require__(\"Fd2+\");\n\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/project/mywater/waterquery/pages/billRead.vue\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// import pdf from 'vue-pdf'\n\n\n\n/* harmony default export */ var billRead = ({\n  components: {\n    headerTwo: headerTwo[\"a\" /* default */]\n  },\n  data: function data() {\n    return {\n      message: {\n        title: \"账单预览\"\n      },\n      emailShow: false,\n      email: '',\n      readImg: '',\n      goUrl: '',\n      //图片预览\n      show: false,\n      index: 0,\n      images: []\n    };\n  },\n  mounted: function mounted() {\n    $('#myTitle').html(this.message.title);\n    // this.readImg = pdf.createLoadingTask(this.readImg)\n    this.goUrl = location.href.split('#')[0] + '#/billDown';\n    this.init();\n  },\n\n  methods: {\n    init: function init() {\n      var _this = this;\n      var groupCode = localStorage.getItem('groupCode');\n      var userNo = localStorage.getItem('userNo');\n      var billMonth = _this.$route.query.billMonth;\n      var params = { //接口入参\n        data: {\n          groupCode: groupCode,\n          userNo: userNo,\n          billMonth: billMonth\n        }\n      };\n      _this.$api.fetch({\n        params: params, //参数\n        apiUrl: '/myWater/getBillPdf' //接口地址\n      }).then(function (res) {\n        _this.readImg = res[0];\n        _this.images.push(_this.readImg);\n        // this.dataURLtoBlob(res);\n      });\n    },\n    sendEmail: function sendEmail() {\n      //发送邮件\n      var _this = this;\n      var groupCode = localStorage.getItem('groupCode');\n      var userNo = localStorage.getItem('userNo');\n      var params = { //接口入参\n        \"data\": {\n          groupCode: groupCode,\n          userNo: userNo\n        }\n      };\n      this.$api.fetch({\n        params: params, //参数\n        apiUrl: '/myWater/emailQuery' //接口地址\n      }).then(function (res) {\n        _this.emailShow = true;\n        _this.email = res;\n      });\n    },\n    billUpLoad: function billUpLoad() {\n      //账单下载\n      var item = {\n        url: ''\n        // this.goUrl+\n      };item.url = \"?groupCode=\" + localStorage.getItem('groupCode') + '&userNo=' + localStorage.getItem('userNo') + '&billMonth=' + this.$route.query.billMonth;\n      // window.location.href = window.location.protocol + \"//\" + window.location.host + '/wxcss2/#/download?url=‘http://testwt.gdhwater.com/wxcss2/myWater/billDownload' + item.url//赤壁水司\n      // window.location.href = window.location.protocol + \"//\" + window.location.host + '/wxcss2/#/download?url=‘http://wx.chibisw.cn/wxcss2/myWater/billDownload' + item.url//赤壁水司\n      window.location.href = window.location.protocol + \"//\" + window.location.host + '/wxcss2/#/download?url=' + window.location.protocol + \"//\" + window.location.host + '/wxcss2/myWater/billDownload' + item.url;\n    },\n    emailTest: function emailTest() {\n      var that = this;\n      console.log(that.email);\n      var message = '';\n      var reg = /^([a-zA-Z]|[0-9])(\\w|\\-)+@[a-zA-Z0-9]+\\.([a-zA-Z]{2,4})$/;\n      if (that.email == '' || that.email == null) {\n        message = '邮箱编号不能为空。';\n        es[\"d\" /* Toast */].fail(message);\n        return;\n      } else if (!reg.test(that.email)) {\n        message = '邮箱编号类型错误。';\n        es[\"d\" /* Toast */].fail(message);\n        return;\n      }\n    },\n    beforeClose: function beforeClose(action, done) {\n      event.stopPropagation();\n      var _this = this;\n      if (action == 'confirm') {\n        // _this.emailTest();\n        var message = '';\n        var reg = /^([a-zA-Z]|[0-9])(\\w|\\-)+@[a-zA-Z0-9]+\\.([a-zA-Z]{2,4})$/;\n        if (_this.email == '' || _this.email == null) {\n          message = '邮箱编号不能为空。';\n          es[\"d\" /* Toast */].fail(message);\n          // 关闭弹框\n          done();\n          // _this.appendChild()\n        } else if (!reg.test(_this.email)) {\n          message = '邮箱编号格式不正确。';\n          es[\"d\" /* Toast */].fail(message);\n          // 关闭弹框\n          done();\n          // _this.appendChild()\n        } else {\n          var groupCode = localStorage.getItem('groupCode');\n          var userNo = localStorage.getItem('userNo');\n          var billMonth = _this.$route.query.billMonth;\n          var params = { //接口入参\n            data: {\n              groupCode: groupCode,\n              userNo: userNo,\n              billMonth: billMonth,\n              email: _this.email\n            }\n          };\n          console.log(params);\n          _this.$api.fetch({\n            params: params, //参数\n            apiUrl: '/myWater/billEmail' //接口地址\n          }).then(function (res) {\n            es[\"d\" /* Toast */].success('账单已成功发送至您邮箱，请稍后查看');\n          });\n          // 关闭弹框\n          done();\n        }\n      } else if (action == 'cancel') {\n        // 关闭弹框\n        done();\n      }\n    },\n\n    //base64 转换 blob\n    dataURLtoBlob: function dataURLtoBlob(dataurl) {\n      var bstr = atob(dataurl);\n      var n = bstr.length;\n      var u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new Blob([u8arr], { type: 'pdf' });\n    },\n\n    //图片预览\n    onChange: function onChange(index) {\n      this.index = index;\n    },\n    takeImage: function takeImage() {\n      this.show = true;\n    }\n  }\n});\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-4d0f10e6\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/project/mywater/waterquery/pages/billRead.vue\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"billRead\"},[_c('page-content',[_c('div',{staticClass:\"billRead-conent\"},[_c('div',{staticClass:\"billRead-img\"},[_c('img',{attrs:{\"src\":'data:image/png;base64,'+_vm.readImg,\"alt\":\"\"}})]),_vm._v(\" \"),_c('div',{staticClass:\"billRead-btn\"},[_c('div',{staticClass:\"billRead-btn-left\"},[_c('m-button',{attrs:{\"size\":\"large\",\"icon\":\"back\"},nativeOn:{\"click\":function($event){_vm.billUpLoad()}}},[_vm._v(\"\\n            账单下载\\n          \")])],1),_vm._v(\" \"),_c('div',{staticClass:\"billRead-btn-right\"},[_c('m-button',{attrs:{\"size\":\"large\",\"icon\":\"back\"},nativeOn:{\"click\":function($event){_vm.sendEmail()}}},[_vm._v(\"\\n            发送邮件\\n          \")])],1)])]),_vm._v(\" \"),_c('van-dialog',{staticClass:\"dialog\",attrs:{\"id\":\"kr-dialog\",\"beforeClose\":_vm.beforeClose,\"title\":\"发送邮件\",\"show-cancel-button\":\"\"},model:{value:(_vm.emailShow),callback:function ($$v) {_vm.emailShow=$$v},expression:\"emailShow\"}},[_c('van-field',{attrs:{\"placeholder\":\"请输入邮箱名\",\"oninput\":\"this.value=this.value.replace(/[^0-9.@a-zA-Z]+/,'');\"},on:{\"blur\":function($event){_vm.emailTest()}},model:{value:(_vm.email),callback:function ($$v) {_vm.email=$$v},expression:\"email\"}})],1)],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\n/* harmony default export */ var pages_billRead = (esExports);\n// CONCATENATED MODULE: ./src/project/mywater/waterquery/pages/billRead.vue\nfunction injectStyle (ssrContext) {\n  __webpack_require__(\"1Sl4\")\n}\nvar normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-4d0f10e6\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  billRead,\n  pages_billRead,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\n/* harmony default export */ var waterquery_pages_billRead = __webpack_exports__[\"default\"] = (Component.exports);\n\n\n/***/ }),\n\n/***/ \"1Sl4\":\n/***/ (function(module, exports, __webpack_require__) {\n\n// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = __webpack_require__(\"vfWn\");\nif(typeof content === 'string') content = [[module.i, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar update = __webpack_require__(\"po5z\")(\"4d97763c\", content, true);\n\n/***/ }),\n\n/***/ \"vfWn\":\n/***/ (function(module, exports, __webpack_require__) {\n\nexports = module.exports = __webpack_require__(\"FZ+f\")(undefined);\n// imports\n\n\n// module\nexports.push([module.i, \".billRead[data-v-4d0f10e6]{height:100%}.billRead .billRead-conent[data-v-4d0f10e6]{padding:1% 2%;height:100%}.billRead .billRead-conent .billRead-img[data-v-4d0f10e6]{height:90%}.billRead .billRead-conent .billRead-img img[data-v-4d0f10e6]{width:100%;height:100%}.billRead .billRead-conent .billRead-btn[data-v-4d0f10e6]{width:100%;height:10%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.billRead .billRead-conent .billRead-btn .billRead-btn-left[data-v-4d0f10e6],.billRead .billRead-conent .billRead-btn .billRead-btn-right[data-v-4d0f10e6]{width:48%}.billRead .billRead-conent .billRead-btn .billRead-btn-right .button[data-v-4d0f10e6]{background:#ed702d}\", \"\"]);\n\n// exports\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/36.ede1d1da886bd1582f46.js","function injectStyle (ssrContext) {\n  require(\"!!vue-loader/node_modules/vue-style-loader!css-loader?minimize!../../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4d0f10e6\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader!../../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./billRead.vue\")\n}\nvar normalizeComponent = require(\"!../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./billRead.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4d0f10e6\\\",\\\"hasScoped\\\":true,\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./billRead.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-4d0f10e6\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/project/mywater/waterquery/pages/billRead.vue\n// module id = null\n// module chunks = ","<template>\r\n  <div class=\"billRead\">\r\n    <!-- <page-header>\r\n      <header-link :left=\"true\" :edge=\"true\" v-back-link>\r\n        <icon icon=\"back\"></icon>返回\r\n      </header-link>\r\n      <header-title>账单预览</header-title>\r\n    </page-header> -->\r\n    <page-content>\r\n      <div class=\"billRead-conent\">\r\n        <!-- @click=\"takeImage()\" -->\r\n        <div class=\"billRead-img\">\r\n          <img :src=\"'data:image/png;base64,'+readImg\" alt=\"\">\r\n        </div>\r\n        <!-- <van-image-preview v-model=\"show\" :images=\"images\" @change=\"onChange\">\r\n          <template v-slot:index>第{{ index }}页</template>\r\n        </van-image-preview> -->\r\n        <div class=\"billRead-btn\">\r\n          <div class=\"billRead-btn-left\">\r\n            <m-button size=\"large\" icon=\"back\" @click.native=\"billUpLoad()\">\r\n              账单下载\r\n            </m-button>\r\n          </div>\r\n          <div class=\"billRead-btn-right\">\r\n            <m-button size=\"large\" icon=\"back\" @click.native=\"sendEmail()\">\r\n              发送邮件\r\n            </m-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <van-dialog class=\"dialog\" id=\"kr-dialog\" v-model=\"emailShow\" :beforeClose=\"beforeClose\" title=\"发送邮件\" show-cancel-button>\r\n        <van-field v-model=\"email\" placeholder=\"请输入邮箱名\" oninput=\"this.value=this.value.replace(/[^0-9.@a-zA-Z]+/,'');\" @blur=\"emailTest()\" />\r\n      </van-dialog>\r\n    </page-content>\r\n  </div>\r\n</template>\r\n<script>\r\n// import pdf from 'vue-pdf'\r\nimport headerTwo from '@/comments/headerTwo';\r\nimport axios from 'axios'\r\nimport { Dialog, Field, Toast, PullRefresh, List, ImagePreview } from 'vant';\r\nexport default {\r\n  components: {\r\n    headerTwo\r\n  },\r\n  data() {\r\n    return {\r\n      message:{\r\n        title:\"账单预览\",\r\n      },\r\n      emailShow: false,\r\n      email: '',\r\n      readImg: '',\r\n      goUrl: '',\r\n      //图片预览\r\n      show: false,\r\n      index: 0,\r\n      images: []\r\n    }\r\n  },\r\n  mounted() {\r\n    $('#myTitle').html(this.message.title)\r\n    // this.readImg = pdf.createLoadingTask(this.readImg)\r\n    this.goUrl = location.href.split('#')[0] + '#/billDown';\r\n    this.init()\r\n  },\r\n  methods: {\r\n    init() {\r\n      let _this = this;\r\n      let groupCode = localStorage.getItem('groupCode');\r\n      let userNo = localStorage.getItem('userNo');\r\n      let billMonth = _this.$route.query.billMonth;\r\n      let params = {//接口入参\r\n        data: {\r\n          groupCode,\r\n          userNo,\r\n          billMonth,\r\n        }\r\n      }\r\n      _this.$api.fetch({\r\n        params,//参数\r\n        apiUrl: '/myWater/getBillPdf',//接口地址\r\n      }).then(res => {\r\n        _this.readImg = res[0];\r\n        _this.images.push(_this.readImg)\r\n        // this.dataURLtoBlob(res);\r\n      })\r\n    },\r\n    sendEmail() {//发送邮件\r\n      let _this = this;\r\n      let groupCode = localStorage.getItem('groupCode');\r\n      let userNo = localStorage.getItem('userNo');\r\n      let params = {//接口入参\r\n        \"data\": {\r\n          groupCode,\r\n          userNo,\r\n        },\r\n      }\r\n      this.$api.fetch({\r\n        params,//参数\r\n        apiUrl: '/myWater/emailQuery',//接口地址\r\n      }).then(res => {\r\n        _this.emailShow = true\r\n        _this.email = res\r\n      })\r\n    },\r\n    billUpLoad() {//账单下载\r\n      let item = {\r\n        url: '',\r\n      }\r\n      // this.goUrl+\r\n      item.url = \"?groupCode=\" + localStorage.getItem('groupCode') + '&userNo='\r\n        + localStorage.getItem('userNo') + '&billMonth=' + this.$route.query.billMonth;\r\n      // window.location.href = window.location.protocol + \"//\" + window.location.host + '/wxcss2/#/download?url=‘http://testwt.gdhwater.com/wxcss2/myWater/billDownload' + item.url//赤壁水司\r\n      // window.location.href = window.location.protocol + \"//\" + window.location.host + '/wxcss2/#/download?url=‘http://wx.chibisw.cn/wxcss2/myWater/billDownload' + item.url//赤壁水司\r\n      window.location.href = window.location.protocol + \"//\" + window.location.host + '/wxcss2/#/download?url=' + window.location.protocol + \"//\" + window.location.host + '/wxcss2/myWater/billDownload' + item.url\r\n    },\r\n    emailTest() {\r\n      let that = this;\r\n      console.log(that.email);\r\n      let message = '';\r\n      let reg = /^([a-zA-Z]|[0-9])(\\w|\\-)+@[a-zA-Z0-9]+\\.([a-zA-Z]{2,4})$/;\r\n      if (that.email == '' || that.email == null) {\r\n        message = '邮箱编号不能为空。';\r\n        Toast.fail(message);\r\n        return\r\n      } else if (!reg.test(that.email)) {\r\n        message = '邮箱编号类型错误。';\r\n        Toast.fail(message);\r\n        return\r\n      }\r\n    },\r\n    beforeClose(action, done) {\r\n      event.stopPropagation();\r\n      let _this = this;\r\n      if (action == 'confirm') {\r\n        // _this.emailTest();\r\n        let message = '';\r\n        let reg = /^([a-zA-Z]|[0-9])(\\w|\\-)+@[a-zA-Z0-9]+\\.([a-zA-Z]{2,4})$/;\r\n        if (_this.email == '' || _this.email == null) {\r\n          message = '邮箱编号不能为空。';\r\n          Toast.fail(message);\r\n          // 关闭弹框\r\n          done()\r\n          // _this.appendChild()\r\n        } else if (!reg.test(_this.email)) {\r\n          message = '邮箱编号格式不正确。';\r\n          Toast.fail(message);\r\n          // 关闭弹框\r\n          done()\r\n          // _this.appendChild()\r\n        } else {\r\n          let groupCode = localStorage.getItem('groupCode');\r\n          let userNo = localStorage.getItem('userNo');\r\n          let billMonth = _this.$route.query.billMonth;\r\n          let params = {//接口入参\r\n            data: {\r\n              groupCode,\r\n              userNo,\r\n              billMonth,\r\n              email: _this.email,\r\n            }\r\n          }\r\n          console.log(params);\r\n          _this.$api.fetch({\r\n            params,//参数\r\n            apiUrl: '/myWater/billEmail',//接口地址\r\n          }).then(res => {\r\n            Toast.success('账单已成功发送至您邮箱，请稍后查看')\r\n          })\r\n          // 关闭弹框\r\n          done()\r\n        }\r\n      } else if (action == 'cancel') {\r\n        // 关闭弹框\r\n        done()\r\n      }\r\n    },\r\n    //base64 转换 blob\r\n    dataURLtoBlob(dataurl) {\r\n      var bstr = atob(dataurl)\r\n      var n = bstr.length;\r\n      var u8arr = new Uint8Array(n);\r\n      while (n--) {\r\n        u8arr[n] = bstr.charCodeAt(n);\r\n      }\r\n      return new Blob([u8arr], { type: 'pdf' });\r\n    },\r\n    //图片预览\r\n    onChange(index) {\r\n      this.index = index;\r\n    },\r\n    takeImage(){\r\n      this.show = true;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.billRead {\r\n  height: 100%;\r\n  .billRead-conent {\r\n    padding: 1% 2%;\r\n    height: 100%;\r\n    .billRead-img {\r\n      height: 90%;\r\n      img {\r\n        width: 100%;\r\n        height: 100%;\r\n      }\r\n    }\r\n    .billRead-btn {\r\n      width: 100%;\r\n      height: 10%;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      .billRead-btn-left {\r\n        width: 48%;\r\n      }\r\n      .billRead-btn-right {\r\n        width: 48%;\r\n        .button {\r\n          background: #ed702d;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/project/mywater/waterquery/pages/billRead.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"billRead\"},[_c('page-content',[_c('div',{staticClass:\"billRead-conent\"},[_c('div',{staticClass:\"billRead-img\"},[_c('img',{attrs:{\"src\":'data:image/png;base64,'+_vm.readImg,\"alt\":\"\"}})]),_vm._v(\" \"),_c('div',{staticClass:\"billRead-btn\"},[_c('div',{staticClass:\"billRead-btn-left\"},[_c('m-button',{attrs:{\"size\":\"large\",\"icon\":\"back\"},nativeOn:{\"click\":function($event){_vm.billUpLoad()}}},[_vm._v(\"\\n            账单下载\\n          \")])],1),_vm._v(\" \"),_c('div',{staticClass:\"billRead-btn-right\"},[_c('m-button',{attrs:{\"size\":\"large\",\"icon\":\"back\"},nativeOn:{\"click\":function($event){_vm.sendEmail()}}},[_vm._v(\"\\n            发送邮件\\n          \")])],1)])]),_vm._v(\" \"),_c('van-dialog',{staticClass:\"dialog\",attrs:{\"id\":\"kr-dialog\",\"beforeClose\":_vm.beforeClose,\"title\":\"发送邮件\",\"show-cancel-button\":\"\"},model:{value:(_vm.emailShow),callback:function ($$v) {_vm.emailShow=$$v},expression:\"emailShow\"}},[_c('van-field',{attrs:{\"placeholder\":\"请输入邮箱名\",\"oninput\":\"this.value=this.value.replace(/[^0-9.@a-zA-Z]+/,'');\"},on:{\"blur\":function($event){_vm.emailTest()}},model:{value:(_vm.email),callback:function ($$v) {_vm.email=$$v},expression:\"email\"}})],1)],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-4d0f10e6\",\"hasScoped\":true,\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/project/mywater/waterquery/pages/billRead.vue\n// module id = null\n// module chunks = ","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/css-loader/index.js?minimize!../../../../../node_modules/vue-loader/lib/style-compiler/index.js?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4d0f10e6\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../../../node_modules/less-loader/dist/cjs.js!../../../../../node_modules/vue-loader/lib/selector.js?type=styles&index=0!./billRead.vue\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar update = require(\"!../../../../../node_modules/vue-loader/node_modules/vue-style-loader/lib/addStylesClient.js\")(\"4d97763c\", content, true);\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/node_modules/vue-style-loader!./node_modules/css-loader?minimize!./node_modules/vue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-4d0f10e6\",\"scoped\":true,\"hasInlineConfig\":false}!./node_modules/less-loader/dist/cjs.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/project/mywater/waterquery/pages/billRead.vue\n// module id = 1Sl4\n// module chunks = 8 36","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(undefined);\n// imports\n\n\n// module\nexports.push([module.id, \".billRead[data-v-4d0f10e6]{height:100%}.billRead .billRead-conent[data-v-4d0f10e6]{padding:1% 2%;height:100%}.billRead .billRead-conent .billRead-img[data-v-4d0f10e6]{height:90%}.billRead .billRead-conent .billRead-img img[data-v-4d0f10e6]{width:100%;height:100%}.billRead .billRead-conent .billRead-btn[data-v-4d0f10e6]{width:100%;height:10%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.billRead .billRead-conent .billRead-btn .billRead-btn-left[data-v-4d0f10e6],.billRead .billRead-conent .billRead-btn .billRead-btn-right[data-v-4d0f10e6]{width:48%}.billRead .billRead-conent .billRead-btn .billRead-btn-right .button[data-v-4d0f10e6]{background:#ed702d}\", \"\"]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-loader?minimize!./node_modules/vue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-4d0f10e6\",\"scoped\":true,\"hasInlineConfig\":false}!./node_modules/less-loader/dist/cjs.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/project/mywater/waterquery/pages/billRead.vue\n// module id = vfWn\n// module chunks = 8 36"],"sourceRoot":""}