webpackJsonp([36],{"/huw":function(e,t,a){"use strict";function l(e){a("1Sl4")}Object.defineProperty(t,"__esModule",{value:!0});var i=a("j8VX"),o=(a("mtWM"),a("Fd2+")),n={components:{headerTwo:i.a},data:function(){return{message:{title:"账单预览"},emailShow:!1,email:"",readImg:"",goUrl:"",show:!1,index:0,images:[]}},mounted:function(){$("#myTitle").html(this.message.title),this.goUrl=location.href.split("#")[0]+"#/billDown",this.init()},methods:{init:function(){var e=this,t=localStorage.getItem("groupCode"),a=localStorage.getItem("userNo"),l=e.$route.query.billMonth,i={data:{groupCode:t,userNo:a,billMonth:l}};e.$api.fetch({params:i,apiUrl:"/myWater/getBillPdf"}).then(function(t){e.readImg=t[0],e.images.push(e.readImg)})},sendEmail:function(){var e=this,t=localStorage.getItem("groupCode"),a=localStorage.getItem("userNo"),l={data:{groupCode:t,userNo:a}};this.$api.fetch({params:l,apiUrl:"/myWater/emailQuery"}).then(function(t){e.emailShow=!0,e.email=t})},billUpLoad:function(){var e={url:""};e.url="?groupCode="+localStorage.getItem("groupCode")+"&userNo="+localStorage.getItem("userNo")+"&billMonth="+this.$route.query.billMonth,window.location.href=window.location.protocol+"//"+window.location.host+"/wxcss2/#/download?url="+window.location.protocol+"//"+window.location.host+"/wxcss2/myWater/billDownload"+e.url},emailTest:function(){var e=this;console.log(e.email);var t="",a=/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;return""==e.email||null==e.email?(t="邮箱编号不能为空。",void o.d.fail(t)):a.test(e.email)?void 0:(t="邮箱编号类型错误。",void o.d.fail(t))},beforeClose:function(e,t){event.stopPropagation();var a=this;if("confirm"==e){var l="",i=/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;if(""==a.email||null==a.email)l="邮箱编号不能为空。",o.d.fail(l),t();else if(i.test(a.email)){var n=localStorage.getItem("groupCode"),d=localStorage.getItem("userNo"),s=a.$route.query.billMonth,r={data:{groupCode:n,userNo:d,billMonth:s,email:a.email}};console.log(r),a.$api.fetch({params:r,apiUrl:"/myWater/billEmail"}).then(function(e){o.d.success("账单已成功发送至您邮箱，请稍后查看")}),t()}else l="邮箱编号格式不正确。",o.d.fail(l),t()}else"cancel"==e&&t()},dataURLtoBlob:function(e){for(var t=atob(e),a=t.length,l=new Uint8Array(a);a--;)l[a]=t.charCodeAt(a);return new Blob([l],{type:"pdf"})},onChange:function(e){this.index=e},takeImage:function(){this.show=!0}}},d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"billRead"},[a("page-content",[a("div",{staticClass:"billRead-conent"},[a("div",{staticClass:"billRead-img"},[a("img",{attrs:{src:"data:image/png;base64,"+e.readImg,alt:""}})]),e._v(" "),a("div",{staticClass:"billRead-btn"},[a("div",{staticClass:"billRead-btn-left"},[a("m-button",{attrs:{size:"large",icon:"back"},nativeOn:{click:function(t){e.billUpLoad()}}},[e._v("\n            账单下载\n          ")])],1),e._v(" "),a("div",{staticClass:"billRead-btn-right"},[a("m-button",{attrs:{size:"large",icon:"back"},nativeOn:{click:function(t){e.sendEmail()}}},[e._v("\n            发送邮件\n          ")])],1)])]),e._v(" "),a("van-dialog",{staticClass:"dialog",attrs:{id:"kr-dialog",beforeClose:e.beforeClose,title:"发送邮件","show-cancel-button":""},model:{value:e.emailShow,callback:function(t){e.emailShow=t},expression:"emailShow"}},[a("van-field",{attrs:{placeholder:"请输入邮箱名",oninput:"this.value=this.value.replace(/[^0-9.@a-zA-Z]+/,'');"},on:{blur:function(t){e.emailTest()}},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1)],1)],1)},s=[],r={render:d,staticRenderFns:s},c=r,u=a("VU/8"),b=l,m=u(n,c,!1,b,"data-v-4d0f10e6",null);t.default=m.exports},"1Sl4":function(e,t,a){var l=a("vfWn");"string"==typeof l&&(l=[[e.i,l,""]]),l.locals&&(e.exports=l.locals);a("po5z")("4d97763c",l,!0)},vfWn:function(e,t,a){t=e.exports=a("FZ+f")(void 0),t.push([e.i,".billRead[data-v-4d0f10e6]{height:100%}.billRead .billRead-conent[data-v-4d0f10e6]{padding:1% 2%;height:100%}.billRead .billRead-conent .billRead-img[data-v-4d0f10e6]{height:90%}.billRead .billRead-conent .billRead-img img[data-v-4d0f10e6]{width:100%;height:100%}.billRead .billRead-conent .billRead-btn[data-v-4d0f10e6]{width:100%;height:10%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.billRead .billRead-conent .billRead-btn .billRead-btn-left[data-v-4d0f10e6],.billRead .billRead-conent .billRead-btn .billRead-btn-right[data-v-4d0f10e6]{width:48%}.billRead .billRead-conent .billRead-btn .billRead-btn-right .button[data-v-4d0f10e6]{background:#ed702d}",""])}});
//# sourceMappingURL=36.ede1d1da886bd1582f46.js.map