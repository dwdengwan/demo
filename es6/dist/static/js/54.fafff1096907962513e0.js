webpackJsonp([54],{"0LVp":function(t,a,o){var e=o("PNkY");"string"==typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);o("po5z")("27477dc9",e,!0)},PNkY:function(t,a,o){a=t.exports=o("FZ+f")(void 0),a.push([t.i,".sales-network .van-tabs__line[data-v-693ab0cf]{background-color:#1a73e8}.sales-network .tab_box[data-v-693ab0cf]{padding:15px;padding-bottom:0}.sales-network .tab_box .item_box[data-v-693ab0cf]{border-bottom:1px solid #d0d0d0;padding-bottom:10px}.sales-network .tab_box .tab_name[data-v-693ab0cf]{font-size:18px}.sales-network .tab_box .tab_addr[data-v-693ab0cf]{font-size:13px;margin-top:15px;color:#94979b}.sales-network .tab_box .tab_content[data-v-693ab0cf]{font-size:13px;margin-top:5px;color:#94979b}.sales-network .tab_box .tab_line[data-v-693ab0cf]{width:100%;height:1px;background:#d0d0d0;margin:0 auto;margin-top:15px}.sales-network .tab_right[data-v-693ab0cf]{padding-top:35px}.sales-network .tab_right .tab_btn[data-v-693ab0cf]{color:#000;border:1px solid #a8aaae;border-radius:30px;height:33px;line-height:33px}.sales-network .tab_right .van-image[data-v-693ab0cf]{color:#000}.sales-network .van-tabs[data-v-693ab0cf]{height:100%}.sales-network .van-tabs .van-tabs__wrap[data-v-693ab0cf]{height:10%}.sales-network .search_box[data-v-693ab0cf]{position:absolute;z-index:9999;height:35px;top:8%;left:3%;width:94%}.sales-network .search_box .van-field[data-v-693ab0cf]{border-radius:12px;-webkit-box-shadow:0 3px 7px -4px;box-shadow:0 3px 7px -4px}.sales-network .search_box .van-cell-group[data-v-693ab0cf]{height:127%}.sales-network .search_box .koron_vant1[data-v-693ab0cf]{display:inline-block;width:25%;padding:10px}.sales-network .search_box .koron_vant1 .van-field__body[data-v-693ab0cf]{border-right:1px solid #888}.sales-network .search_box .koron_vant2[data-v-693ab0cf]{display:inline-block;width:45%;padding:10px 5px}.sales-network .search_box .koron_vant3[data-v-693ab0cf]{display:inline-block;width:24%;padding:10px;background:#454545;float:right}.sales-network .search_box .first_sel[data-v-693ab0cf],.sales-network .search_box .second_sel[data-v-693ab0cf]{height:1.7rem;width:35%;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.sales-network .search_box .third_btn[data-v-693ab0cf]{width:18%;display:inline-block;background:#454545;color:#fff;text-align:center;font-size:13px;height:1.65rem;line-height:36px}.sales-network .search_box .third_btn img[data-v-693ab0cf]{height:30px;display:inline-block;vertical-align:middle;margin-top:-5px;margin-left:3px}.sales-network .search_box .third_btn span[data-v-693ab0cf]{margin-left:-5px;margin-right:17px}.sales-network .content-padded[data-v-693ab0cf]{height:100%;margin:0}.sales-network .content-padded .list[data-v-693ab0cf]{margin:0}.sales-network .content-padded .amap-demo[data-v-693ab0cf]{height:88.7vh}.sales-network .content-padded .prompt[data-v-693ab0cf]{background:#fff;width:100px;height:30px;text-align:center}.sales-network .kr-map[data-v-693ab0cf]{height:100%}.sales-network .addr_popup[data-v-693ab0cf]{max-height:345px}.sales-network .btm_click[data-v-693ab0cf]{position:fixed;bottom:0;text-align:center;width:100%;background:#fff;height:35px;line-height:35px;-webkit-box-shadow:1px 0 8px 1px;box-shadow:1px 0 8px 1px;font-size:14px}",""])},dIXg:function(t,a,o){"use strict";function e(t){o("0LVp")}Object.defineProperty(a,"__esModule",{value:!0});var n=o("mvHQ"),i=o.n(n),s=(o("Fd2+"),o("rYnR")),r={components:{myHeader:s.default},data:function(){var t=this;return{active:2,isLoading:!1,scrollTop:0,zoom:11,center:[121.59996,31.197646],markers:[],windows:[],window:"",plugin:[{pName:"Geolocation",events:{init:function(a){a.getCurrentPosition(function(a,o){o&&o.position&&(t.lng=o.position.lng,t.lat=o.position.lat)})}}}],noteData:[],myAddress:[],companyData:[],second_sel:null,first_sel:null,groupCode:null,wxData:null,location:null,userbindCompany:[],relationShow:!1,showAddress:!1,areaNum:"01013",areaList:{},userlist:{},groupName:"",networkName:"",salesNetWorkShow:!1,netWorkColumns:[],initConfigUrl:"",addrShow:!1}},mounted:function(){var t=this;this.getGeolocation(),setTimeout(function(){$("#myTitle").html("营业网点"),t.getArrList2(),t.initConfigMes()},1e3)},methods:{display:function(t){console.log(t,"666"),this.addrShow=!1,this.relationShow=!1},openAddr:function(){this.addrShow=!0},scroll:function(t){parseInt(t.target.clientHeight)+Math.ceil(t.target.scrollTop)===parseInt(t.target.scrollHeight)||0==t.target.scrollTop&&t.stopPropagation(),this.$set(this,"scrollTop",t.target.scrollTop)},touchmove:function(t){0!==this.scrollTop&&t.stopPropagation()},onRefresh:function(){var t=this;setTimeout(function(){t.$toast("刷新成功"),t.isLoading=!1,t.getArrList2(),t.initConfigMes()},500)},showNetWork:function(){this.salesNetWorkShow=!0,this.relationShow=!1},showAddressChuang:function(){this.relationShow=!0,this.salesNetWorkShow=!1},sure:function(t){console.log(t),void 0===t[2]||""==t[2].code?(this.groupCode=t[1].code.slice(2),this.groupName=t[0].name+t[1].name):(this.groupCode=t[2].code.slice(4),this.groupName=t[0].name+t[1].name+t[2].name),this.groupName=this.groupName.replace("*",""),this.relationShow=!1,this.first_sel=this.groupCode,this.choice_company(this.groupCode),1==this.active&&(this.addrShow=!0)},exit:function(){this.relationShow=!1},onChange:function(){},getArrList2:function(){var t=this,a={data:{openId:localStorage.getItem("openId")}};t.$api.fetch({params:a,apiUrl:"/common/wAreaTree"}).then(function(a){if(t.areaList.province_list=a.provinceMap,t.areaList.city_list=a.cityMap,t.areaList.county_list=a.areaMap,t.userbindCompany=JSON.parse(localStorage.getItem("bwcList")),t.userbindCompany[0]){t.first_sel=t.userbindCompany[0].groupCode,t.groupName=t.userbindCompany[0].groupName;for(var o in t.areaList.county_list){var e=o.slice(4);if(t.first_sel==e)t.areaNum=o;else for(var n in t.areaList.city_list){var i=n.slice(2);t.first_sel==i&&(t.areaNum=n)}}t.groupCode=t.first_sel,t.choice_company(t.first_sel)}t.getBindData()})},getBindData:function(){var t=this,a={data:{}};t.$api.fetch({params:a,apiUrl:"/common/getUserInfo"}).then(function(a){var o=a.bwcList;console.log(o),o.length>0?(t.groupCode=o[0].groupCode,t.groupName=o[0].groupName,t.querySalesNetWok(t.groupCode)):t.getGeolocation1()})},getSpaceNum:function(t,a){var o=this,e={data:{longitude:t,latitude:a}};o.$api.fetch({params:e,apiUrl:"/common/getShortestComp"}).then(function(t){o.groupCode=t.groupCode,o.groupName=t.groupArea,o.querySalesNetWok(o.groupCode)})},getGeolocation1:function(){var t=this,a=new AMap.Map("container",{resizeEnable:!0});AMap.plugin("AMap.Geolocation",function(){var o=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB",buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0});a.addControl(o),o.getCurrentPosition(function(a,o){"complete"==a&&(alert(i()(o)),t.getSpaceNum(o.position.lng,o.position.lat))})})},initConfigMes:function(){var t=this,a={data:{url:window.location.href.split("#")[0]}};this.$api.fetch({params:a,apiUrl:"/public/wxConfigMes"}).then(function(a){t.wxData=a,t.wx.config({appId:a.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:["openLocation"]})})},queryCompanyMes:function(){var t=this,a={data:{groupCode:t.groupCode}};this.$api.fetch({params:a,apiUrl:"/public/companyList"}).then(function(a){t.companyData=a,t.userbindCompany=[{groupCode:"1",groupName:"梧州水司"},{groupCode:"3",groupName:"南沙水司"},{groupCode:"2",groupName:"肇庆水司"}],t.userbindCompany[0]?t.first_sel=t.userbindCompany[0].groupCode:t.first_sel=t.companyData[0].groupCode,t.choice_company()})},querySalesNetWok:function(t){var a=this;this.networkName="",this.markers=[],this.windows=[];var o=[],e=[];this.netWorkColumns=[];var n=[],i=this,s={data:{groupCode:t}};this.$api.fetch({params:s,apiUrl:"/public/storesList"}).then(function(t){i.noteData=t;for(var s=0;s<i.noteData.length;s++){var r=i.noteData[s].long_lat.split("-");i.noteData[s].lng=r[0],i.noteData[s].lat=r[1],i.noteData[s].distance=0,i.noteData[s].distance=i.GetDistance(Number(i.myAddress[0]),Number(i.myAddress[1]),Number(r[0]),Number(r[1])),i.noteData[s].distance=i.noteData[s].distance.toFixed(2)}var l=t,c=a;if(l.length<1)return null;for(var p=0;p<l.length;p++)!function(t){var a=l[t].long_lat.split("-");o.push({position:[a[0],a[1]],text:'<img src="/wxcss2/static/img/zuobiao1.png" alt="">  '+l[t].name+"&nbsp;",visible:!0,offset:[0,-50],events:{click:function(){c.windows.forEach(function(t){t.visible=!1}),c.window=c.windows[t],c.$nextTick(function(){c.window.visible=!0,i.second_sel=t})}}}),e.push({position:[a[0],a[1]],content:""+l[t].name,visible:!1}),n.push(""+l[t].name)}(p);i.markers=o,console.log(i.markers),i.windows=e,i.netWorkColumns=n,i.center=o[0].position,i.second_sel=0,i.choice_sec()})},getMapForTable:function(t){var a=this;this.salesNetWorkShow=!1,this.relationShow=!1,a.wx.openLocation({longitude:parseFloat(t.lng),latitude:parseFloat(t.lat),name:t.name,address:t.name,scale:14})},getMap:function(){var t=this;this.salesNetWorkShow=!1,this.relationShow=!1,t.wx.openLocation({longitude:parseFloat(t.location.position[0]),latitude:parseFloat(t.location.position[1]),name:t.location.content,address:t.location.content,scale:14})},choice_company:function(t){this.querySalesNetWok(this.first_sel)},choice_netWork:function(t,a){if(this.salesNetWorkShow=!1,0==a.length)return null;this.second_sel=a,this.choice_sec()},choice_sec:function(t){var a=this;a.windows.forEach(function(t){t.visible=!1}),a.window=a.windows[this.second_sel],a.$nextTick(function(){a.window.visible=!0}),this.networkName=a.windows[this.second_sel].content,this.center=a.windows[this.second_sel].position,this.location=a.windows[this.second_sel]},getGeolocation:function(){var t=this,a=new AMap.Map("container",{resizeEnable:!0});AMap.plugin("AMap.Geolocation",function(){var o=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB",buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0});a.addControl(o),o.getCurrentPosition(function(a,o){"complete"==a&&(t.myAddress.push(o.position.lng),t.myAddress.push(o.position.lat))})})},onComplete:function(t){var a=[];a.push("定位结果："+t.position),a.push("定位类别："+t.location_type),t.accuracy&&a.push("精度："+t.accuracy+" 米"),a.push("是否经过偏移："+(t.isConverted?"是":"否")),console.log(a)},onError:function(t){console.log("定位失败"),console.log(t.message)},GetDistance:function(t,a,o,e){var n=t*Math.PI/180,i=o*Math.PI/180,s=n-i,r=a*Math.PI/180-e*Math.PI/180,l=2*Math.asin(Math.sqrt(Math.pow(Math.sin(s/2),2)+Math.cos(n)*Math.cos(i)*Math.pow(Math.sin(r/2),2)));return l*=6378.137,l=Math.round(1e4*l)/1e4}}},l=function(){var t=this,a=t.$createElement,o=t._self._c||a;return o("div",{staticClass:"sales-network"},[o("page-content",[o("van-tabs",{on:{click:function(a){t.display(a)}},model:{value:t.active,callback:function(a){t.active=a},expression:"active"}},[o("van-tab",{attrs:{title:"列表模式"}},[o("van-field",{staticStyle:{"margin-bottom":"5px"},attrs:{"right-icon":"arrow","left-icon":"location",label:"所属地区：",value:t.groupName,placeholder:"水司区域",readonly:""},on:{click:t.showAddressChuang}}),t._v(" "),t._l(t.noteData,function(a){return o("div",{key:a.long_lat,staticClass:"tab_box",on:{click:function(o){t.getMapForTable(a)}}},[o("div",{staticClass:"item_box"},[o("div",{staticClass:"tab_name"},[t._v("\n              "+t._s(a.name)+"\n            ")]),t._v(" "),o("div",{staticClass:"tab_addr"},[o("span",[o("van-icon",{staticStyle:{"font-size":"12px"},attrs:{name:"location",color:"#7C8EAA"}}),t._v("   "+t._s(a.distance)+"km    ")],1),t._v(" "),o("span",[t._v(t._s(a.address))])]),t._v(" "),o("div",{staticClass:"tab_content"},[t._v("\n              服务时间："+t._s(a.businessHour)+"\n            ")]),t._v(" "),o("div",{staticClass:"tab_content"},[t._v("\n              联系电话："+t._s(a.telephone)+"\n            ")])])])})],2),t._v(" "),o("van-tab",{attrs:{title:"地图模式"}},[o("div",{staticClass:"content-padded",on:{click:function(a){t.addrShow=!1}}},[o("div",{staticClass:"row kr-map"},[o("div",{staticClass:"search_box"},[o("van-field",{staticStyle:{"margin-bottom":"5px"},attrs:{"right-icon":"arrow","left-icon":"location",label:"所属地区：",value:t.groupName,placeholder:"水司区域",readonly:""},on:{click:t.showAddressChuang}})],1),t._v(" "),o("div",{staticClass:"col-100"},[o("el-amap",{staticClass:"amap-demo",attrs:{vid:"amapDemo",center:t.center,plugin:t.plugin,scrollWheel:!0}},[t._l(t.markers,function(t,a){return o("el-amap-marker",{key:a,attrs:{position:t.position,events:t.events}})}),t._v(" "),t._l(t.markers,function(t,a){return o("el-amap-text",{key:"info2-"+a,attrs:{visible:t.visible,text:t.text,offset:t.offset,position:t.position,events:t.events}})})],2)],1)])]),t._v(" "),o("div",{staticClass:"btm_click",on:{click:t.openAddr}},[t._v("点击查看更多结果")])])],1)],1),t._v(" "),o("van-popup",{style:{height:"40%"},attrs:{position:"bottom"},model:{value:t.relationShow,callback:function(a){t.relationShow=a},expression:"relationShow"}},[o("van-area",{attrs:{"area-list":t.areaList,value:t.areaNum},on:{confirm:t.sure,cancel:t.exit,change:t.onChange}})],1),t._v(" "),o("van-popup",{style:{height:"40%"},attrs:{position:"bottom"},model:{value:t.salesNetWorkShow,callback:function(a){t.salesNetWorkShow=a},expression:"salesNetWorkShow"}},[o("van-picker",{attrs:{columns:t.netWorkColumns,"show-toolbar":"",title:"营业网点"},on:{confirm:t.choice_netWork,cancel:function(a){t.salesNetWorkShow=!1}}})],1),t._v(" "),o("van-popup",{staticClass:"addr_popup",attrs:{position:"bottom",overlay:!0},model:{value:t.addrShow,callback:function(a){t.addrShow=a},expression:"addrShow"}},t._l(t.noteData,function(a){return o("div",{key:a.long_lat,staticClass:"tab_box popup_tab",on:{click:function(o){t.getMapForTable(a)}}},[o("div",{staticClass:"item_box",staticStyle:{display:"flex"}},[o("div",{staticStyle:{flex:"1"}},[o("div",{staticClass:"tab_name"},[t._v("\n            "+t._s(a.name)+"\n          ")]),t._v(" "),o("div",{staticClass:"tab_addr"},[o("span",[o("van-icon",{staticStyle:{"font-size":"12px"},attrs:{name:"location",color:"#7C8EAA"}}),t._v("   "+t._s(a.distance)+"km    ")],1),t._v(" "),o("span",[t._v(t._s(a.address))])]),t._v(" "),o("div",{staticClass:"tab_content"},[t._v("\n            服务时间："+t._s(a.businessHour)+"\n          ")]),t._v(" "),o("div",{staticClass:"tab_content"},[t._v("\n            联系电话："+t._s(a.telephone)+"\n          ")])]),t._v(" "),o("div",{staticClass:"tab_right"},[o("van-button",{staticClass:"tab_btn",attrs:{plain:"",hairline:"",type:"info",icon:"/wxcss2/static/img/daohang.png"}},[t._v("导航")])],1)])])}))],1)},c=[],p={render:l,staticRenderFns:c},d=p,h=o("VU/8"),u=e,g=h(r,d,!1,u,"data-v-693ab0cf",null);a.default=g.exports}});
//# sourceMappingURL=54.fafff1096907962513e0.js.map